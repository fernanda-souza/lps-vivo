!function(e){e.fn.drag=function(e,t,r){return t&&this.bind("dragstart",e),r&&this.bind("dragend",r),e?this.bind("drag",t||e):this.trigger("drag")};var t=e.event,r=t.special,n=r.drag={not:":input",distance:0,which:1,dragging:!1,setup:function(r){(r=e.extend({distance:n.distance,which:n.which,not:n.not},r||{})).distance=o(r.distance),t.add(this,"mousedown",a,r),this.attachEvent&&this.attachEvent("ondragstart",d)},teardown:function(){t.remove(this,"mousedown",a),this===n.dragging&&(n.dragging=n.proxy=!1),s(this,!0),this.detachEvent&&this.detachEvent("ondragstart",d)}};function a(d){var i,u=this,c=d.data||{};if(c.elem)u=d.dragTarget=c.elem,d.dragProxy=n.proxy||u,d.cursorOffsetX=c.pageX-c.left,d.cursorOffsetY=c.pageY-c.top,d.offsetX=d.pageX-d.cursorOffsetX,d.offsetY=d.pageY-d.cursorOffsetY;else if(n.dragging||c.which>0&&d.which!=c.which||e(d.target).is(c.not))return;switch(d.type){case"mousedown":return e.extend(c,e(u).offset(),{elem:u,target:d.target,pageX:d.pageX,pageY:d.pageY}),t.add(document,"mousemove mouseup",a,c),s(u,!1),n.dragging=null,!1;case!n.dragging&&"mousemove":if(o(d.pageX-c.pageX)+o(d.pageY-c.pageY)<c.distance)break;d.target=c.target,!1!==(i=g(d,"dragstart",u))&&(n.dragging=u,n.proxy=d.dragProxy=e(i||u)[0]);case"mousemove":if(n.dragging){if(i=g(d,"drag",u),r.drop&&(r.drop.allowed=!1!==i,r.drop.handler(d)),!1!==i)break;d.type="mouseup"}case"mouseup":t.remove(document,"mousemove mouseup",a),n.dragging&&(r.drop&&r.drop.handler(d),g(d,"dragend",u)),s(u,!0),n.dragging=n.proxy=c.elem=!1}return!0}function g(t,r,n){t.type=r;var a=e.event.handle.call(n,t);return!1!==a&&(a||t.result)}function o(e){return Math.pow(e,2)}function d(){return!1===n.dragging}function s(e,t){e&&(e.unselectable=t?"off":"on",e.onselectstart=function(){return t},e.style&&(e.style.MozUserSelect=t?"":"none"))}r.dragstart=r.dragend={setup:function(){},teardown:function(){}}}(jQuery);